var canClick={}
function checkForValidUrl(tabId,changeInfo,tab){chrome.tabs.sendMessage(tabId,{type:"check"},function(cb){canClick[tabId]=cb;if(cb!=null){chrome.pageAction.show(tabId);chrome.pageAction.setIcon({path:"icon-48c.png",tabId:tabId});}else{}})};chrome.tabs.onUpdated.addListener(function(tabId,changeInfo,tab){if(changeInfo.status=="complete"&&tab.url.indexOf('sync-video.com')<0){checkForValidUrl(tabId,changeInfo,tab);}});chrome.pageAction.onClicked.addListener(function(tab){if(canClick[tab.id]!=null){chrome.tabs.sendMessage(tab.id,{"type":"redirect","movie":canClick[tab.id]},function res(cb){})}else{}})
chrome.extension.onConnect.addListener(function(port){port.onMessage.addListener(function(tab){if(canClick[tab.id]!=null){chrome.tabs.sendMessage(tab.id,{"type":"redirect","movie":canClick[tab.id]},function res(cb){})}else{}})})